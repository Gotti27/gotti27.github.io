<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Self Certification Bot | Mario Gottardo </title> <meta name="author" content="Mario Gottardo"> <meta name="description" content="how I solved certificate generation in closed networks"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://gotti27.github.io/blog/2025/self-cert-bot/"> <script src="/assets/js/theme.js?834142006d28d281ecff79e129223280"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Mario</span> Gottardo </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/news/">news </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Self Certification Bot</h1> <p class="post-meta"> Created in June 20, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/category/networking"> <i class="fa-solid fa-tag fa-sm"></i> networking</a>   <a href="/blog/category/software"> <i class="fa-solid fa-tag fa-sm"></i> software</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>Every man at some point in his life decides either to farm or to run his own Root Certification Authority.</p> </blockquote> <h2 id="introduction">Introduction</h2> <p>The <em>Let’s Encrypt</em> CertBot<sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> is surely an exceptionally useful tool, however it requires the host to be public reachable. This means that it’s not useable when dealing with private networks.</p> <p>As I’ll describe in another post about my network infrastructure, I’m running various servers and services in a closed network environment. This realm came at the price of manually handling TLS certificates, without the advantages of using a certification bot and an ACME CA.</p> <p>So far I handled the certificate generation with a Python script, which is available in my homeLab scripts repository<sup id="fnref:4"><a href="#fn:4" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>. However, such script required to generate the certificate on the same machine hosting my Root CA files, and then to transfer manually the certificate files to the right machine. Too much exposure and overhead for a task that could be improved with a cool project. And so the journey began.</p> <h2 id="some-background">Some Background</h2> <p>I’m sure that if you’re reading this post, you should have all the required knowledge to understand it. Despite this, it’s always useful to review some background theory.</p> <p>HTTPS consists in the addition of an encryption layer to HTTP, which is a plain text protocol. This translates in exchanging the HTTP protocol on a TLS (Transport Layer Security) session<sup id="fnref:2"><a href="#fn:2" class="footnote" rel="footnote" role="doc-noteref">3</a></sup>. Lastly, the TLS protocol requires an RSA key pair to initialize the session and derive a symmetric key.</p> <p>Skipping why we need domains over ip addresses, the point is: how can we be sure of the server identity? In other words, how can we assure that the TLS connection has been truly established with <em>example.com</em>? Here’s where certificates and the DNS join the party. As we all know, a DNS (Domain Name System) bounds a domain name to an IP address and other kind of records.</p> <p>On the other hand, cryptographically speaking in a broad sense, a certificate is a signed piece of information. We can trust the content of a certificate as truth if we trust the entity that signed the certificate itself. In this specific case, the certificate holds the public key held by the server and the website domain. Hence, a certificate is bounding a domain to a public key, other than auxiliary information like the organization’s data.</p> <h3 id="getting-certified">Getting certified</h3> <p>The last section brings us to the question: how do I get a certificate for my domain? Well, the issuer needs to verify that who’s asking for a certificate truly is the owner of the certificate. While many registrar provide their own wildcard certificates if you’re holding your domain on their system, we are focusing on the other type of issuance, i.e. the challenge based one. The other - cooler - way, is to ask to an ACME certification authority, which will deploy an ownership challenge<sup id="fnref:3"><a href="#fn:3" class="footnote" rel="footnote" role="doc-noteref">4</a></sup> to solve like the following ones:</p> <ul> <li>HTTP-01</li> <li>DNS-01</li> <li>TLS-ALPN-01</li> </ul> <p>Once the challenge has been solved, the ACME CA will issue the certificate and that’s done.</p> <h2 id="the-solution">The solution</h2> <blockquote> <p>Yeah, well, I’m gonna go build my own <del>theme park</del> certification bot. With blackjack and hookers!</p> </blockquote> <div class="d-flex row"> <div class="col-sm d-flex justify-content-center"> <div class="tenor-gif-embed d-flex justify-content-start" data-postid="20104589" data-share-method="host" data-aspect-ratio="1.33333" data-width="50%"> <a href="https://tenor.com/view/futurama-blackjack-and-hookers-bender-gif-20104589" rel="external nofollow noopener" target="_blank">Futurama Blackjack GIF</a>from <a href="https://tenor.com/search/futurama-gifs" rel="external nofollow noopener" target="_blank">Futurama GIFs</a> </div> <script type="text/javascript" async="" src="https://tenor.com/embed.js"></script> </div> </div> <p>Theoretically, HTTPS shouldn’t be required when packets are traveling on safe networks, like in my homelab setting. However, modern browsers are - rightfully - complaining when you are visiting a plain-HTTP website or one serving an untrusted TLS certificate. Hence, I decided to add TLS to all my services using a main nginx-gateway for encryption handling.</p> <p>As introduced in the first section, my current setting involves a Root CA of mine (MostSerene Root), which certificates are installed on the clients’ machines. All the child certificates are eventually signed with the Root CA private key and hence accepted by the browsers.</p> <p>Driven by the constant desire of automate tedious activities like these ones, the solution was to build a simple certification bot and certification challenge on my own. Regarding the technical stack, since I’m forced to work with Python in my current job, and that snake makes me feel dumber the more I use it, I decided to work with C++ to keep me sharp.</p> <p>Obviously, similarly to the Let’s encrypt, the self certification bot must be able to reach and connect to the claimant machine.</p> <h2 id="the-protocol">The protocol</h2> <p>For the sake of this project, we can define the domain ownership as control over the requested domain. Namely, the claimant controls the server with ip corresponding to the DNS record value.</p> <p>To do so, the standard approach is to use a challenge, i.e. a generated token that the certifier is expected to retrieve back when resolving the domain.</p> <p>In my simple protocol, the client starts the communication by performing a TLS handshake with the certifier server. When a secure channel has been established, the client communicates the desired domain name to the server, its X509 fields and its public key. The certifier proceeds to generate the secret and send it to the claimant.</p> <p>After the client has sent an acknowledge and communicated a port, the server will resolve the requested domain and establish a secondary connection on the given port and request the token.</p> <p>If the peer on the secondary connection replies with the correct token, the certifier will proceed to generate and sign the child certificate, and eventually send it to the client. Once received, the claimant will save it to the disk and close the connection.</p> <p>In case the server cannot establish the secondary connection or in case of a challenge mismatch, the client will be informed that an error occurred and the connection will be closed. In such case, a rate-limiting strategy will be enforced in future versions.</p> <h2 id="limitations">Limitations</h2> <p>A main issue of my approach and implementation appears in case of a DNS spoofing attack. However, since the project is meant to be used in closed environments, I considered it a secondary issue. To address this, a common solution would be to use multiple DNSs or to use DNSSEC.</p> <p>Other kind of limitation may be discovered with a penetration testing activity.</p> <h2 id="future-work">Future work</h2> <p>Beyond improving the security of the project with rate-limiting, etc., I’m intrigued by the certificates usage outside of the traditional ways like HTTPS. For instance, zero trust networks may use certificates to enforce user-based capabilities with distributed consistency. In this sense, one area that I plan to explore in my next free time projects are wireguard protocol extensions, aimed to enforce certificate based authorization.</p> <h2 id="distribution">Distribution</h2> <p>The entire codebase of the project is available on a repository<sup id="fnref:5"><a href="#fn:5" class="footnote" rel="footnote" role="doc-noteref">5</a></sup> hosted by GitHub. Regarding packaging and distribution, the project will be shortly packaged and distributed as an APT package and a docker image.</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1"> <p><a href="https://certbot.eff.org/" rel="external nofollow noopener" target="_blank">Let’s Encrypt certbot</a> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:4"> <p><a href="https://github.com/Gotti27/homelab-scripts" rel="external nofollow noopener" target="_blank">HomeLab script repo</a> <a href="#fnref:4" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:2"> <p><a href="https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/" rel="external nofollow noopener" target="_blank">Cloudflare TLS handshake</a> <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:3"> <p><a href="https://letsencrypt.org/docs/challenge-types/" rel="external nofollow noopener" target="_blank">ACME Challenges</a> <a href="#fnref:3" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:5"> <p><a href="https://github.com/Gotti27/self-cert-bot" rel="external nofollow noopener" target="_blank">Self-cert-bot repository</a> <a href="#fnref:5" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Mario Gottardo. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Last updated: September 13, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-news",title:"news",description:"",section:"Navigation",handler:()=>{window.location.href="/news/"}},{id:"nav-projects",title:"projects",description:"My current and past projects",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-repositories",title:"repositories",description:"My GitHub profile and some selected public repositories",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"nav-cv",title:"cv",description:"",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"nav-publications",title:"publications",description:"publications by categories in reversed chronological order. generated by jekyll-scholar.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"post-self-certification-bot",title:"Self Certification Bot",description:"how I solved certificate generation in closed networks",section:"Posts",handler:()=>{window.location.href="/blog/2025/self-cert-bot/"}},{id:"news-master-39-s-thesis-defense-scheduled-for-october-the-17th-2024",title:"Master&#39;s thesis defense scheduled for October the 17th 2024",description:"",section:"News"},{id:"news-i-have-officially-graduated-with-an-m-sc-in-computer-science-from-ca-39-foscari-university-of-venice",title:"I have officially graduated with an M.Sc. in Computer Science from Ca&#39; Foscari...",description:"",section:"News"},{id:"news-our-poster-paper-has-been-accepted-at-stag24",title:"Our poster paper has been accepted at STAG24",description:"",section:"News",handler:()=>{window.location.href="/news/stag24-paper-accepted/"}},{id:"projects-2columns",title:"2columnS",description:"an ML-based network intrusion detection system",section:"Projects",handler:()=>{window.location.href="/projects/2columns-nids/"}},{id:"projects-3d-laser-scanner",title:"3D laser scanner",description:"An implementation of a line laser scanner",section:"Projects",handler:()=>{window.location.href="/projects/3d-scanner/"}},{id:"projects-avogador",title:"Avogador",description:"an academic driven code evaluation platform",section:"Projects",handler:()=>{window.location.href="/projects/avogador/"}},{id:"projects-face-landmarks-estimation",title:"Face landmarks estimation",description:"",section:"Projects",handler:()=>{window.location.href="/projects/face-landmark-estimation/"}},{id:"projects-master-39-s-thesis",title:"Master&#39;s Thesis",description:"line laser implicit neural representation",section:"Projects",handler:()=>{window.location.href="/projects/masters-thesis/"}},{id:"projects-self-certfication-bot",title:"Self Certfication Bot",description:"",section:"Projects",handler:()=>{window.location.href="/projects/self-cert-bot/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%6D%61%72%69%6F.%67%6F%74%74%61%72%64%6F@%6D%6F%73%74%73%65%72%65%6E%65.%65%75","_blank")}},{id:"socials-orcid",title:"ORCID",section:"Socials",handler:()=>{window.open("https://orcid.org/0009-0009-1826-4059","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=LD_H5vgAAAAJ","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/Gotti27","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/mario-gottardo-744b201a3","_blank")}},{id:"socials-kaggle",title:"Kaggle",section:"Socials",handler:()=>{window.open("https://www.kaggle.com/gotti27","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>